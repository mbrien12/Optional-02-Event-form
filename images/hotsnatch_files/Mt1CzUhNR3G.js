if (self.CavalryLogger) { CavalryLogger.start_js(["vroeN"]); }

__d("PinnedConversationNubsActionTaken",[],(function a(b,c,d,e,f,g){f.exports={TAB_CLOSED_BY_USER:0,COMMENT_ADDED:1}}),null);
__d("ConversationNubTabStateListStorage",[],(function a(b,c,d,e,f,g){"use strict";function h(){this.$ConversationNubTabStateListStorage1=[]}h.prototype.modify=function(i){this.$ConversationNubTabStateListStorage1=i(this.$ConversationNubTabStateListStorage1)};h.prototype.getData=function(){return this.$ConversationNubTabStateListStorage1};f.exports=h}),null);
__d("ConversationNubTabStateList",["invariant","ConversationNubTabStateListStorage","Set","differenceSets"],(function a(b,c,d,e,f,g,h){"use strict";function i(){this.$ConversationNubTabStateList2=new(c("Set"))();this.$ConversationNubTabStateList1=new(c("ConversationNubTabStateListStorage"))()}i.prototype.modifyTabState=function(j,k){this.modifyTabs(function(l){var m=l.findIndex(function(n){return n.tabID===j});m!==-1||h(0);k(l[m]);return l})};i.prototype.$ConversationNubTabStateList3=function(j){return new(c("Set"))(j.map(function(k){return k.tabID}))};i.prototype.modifyTabs=function(j){try{this.$ConversationNubTabStateList1.modify(function(k){var l=this.$ConversationNubTabStateList3(k),m=j(k),n=this.$ConversationNubTabStateList3(m);this.$ConversationNubTabStateList2=c("differenceSets")(l,n);return m}.bind(this))}finally{this.$ConversationNubTabStateList2=new(c("Set"))()}};i.prototype.getTabs=function(){return this.$ConversationNubTabStateList1.getData()};i.prototype.getTabState=function(j){var k=this.getTabStateIfExists(j);k||h(0);return k};i.prototype.getTabStateIfExists=function(j){return this.getTabs().find(function(k){return k.tabID===j})};i.prototype.push=function(){for(var j=arguments.length,k=Array(j),l=0;l<j;l++)k[l]=arguments[l];this.modifyTabs(function(m){k.forEach(function(n){if(m.find(function(o){return o.tabID===n.tabID}))h(0);else m.push(n)});return m})};i.prototype.remove=function(j){this.modifyTabs(function(k){var l=k.findIndex(function(m){return m.tabID===j});if(l!==-1)k.splice(l,1);return k})};f.exports=i}),null);
__d("ConversationNubTabState",["invariant","ConversationNubTabStateList"],(function a(b,c,d,e,f,g,h){"use strict";var i=12;function j(){this.$ConversationNubTabStateClass1=Object.create(null);this.$ConversationNubTabStateClass2=new(c("ConversationNubTabStateList"))();this.$ConversationNubTabStateClass3=Infinity}j.prototype.anyTabHasFocus=function(){return this.getUnsortedLoadedTabs().some(function(k){return k.getIsFocused()})};j.prototype.anyTabHasText=function(){return this.getUnsortedLoadedTabs().some(function(k){return k.getHasText()})};j.prototype.getTabState=function(k){return this.$ConversationNubTabStateClass2.getTabState(k)};j.prototype.getTabStateIfExists=function(k){return this.$ConversationNubTabStateClass2.getTabStateIfExists(k)};j.prototype.getUnloadedTabs=function(){var k=this.$ConversationNubTabStateClass2.getTabs().filter(function(l){return!this.getLoadedTab(l.tabID)}.bind(this));return k};j.prototype.setMaxDockTabs=function(k){this.$ConversationNubTabStateClass3=k};j.prototype.getNumDockTabs=function(){var k=this.$ConversationNubTabStateClass3,l=this.getTotalTabCount();return Math.min(k,l)};j.prototype.getNumMenuTabs=function(){return this.getTotalTabCount()-this.getNumDockTabs()};j.prototype.addTabState=function(k){this.$ConversationNubTabStateClass2.push(k)};j.prototype.addLoadedTab=function(k,l){var m=this.getTabState(k);if(!m)return;var n=this.getLoadedTab(k);if(n)return;this.$ConversationNubTabStateClass1[k]=l;this.$ConversationNubTabStateClass4()};j.prototype.getLoadedTab=function(k){return this.$ConversationNubTabStateClass1[k]};j.prototype.getLoadedTabByFeedbackTarget=function(k){return this.getLoadedTabs().find(function(l){return l.getPersistentState().ftID===k})};j.prototype.isTabInDock=function(k){var l=this.getLoadedTab(k);if(!l)return false;var m=this.$ConversationNubTabStateClass5(l);return 0<=m&&m<this.getNumDockTabs()};j.prototype.clearTabNotifications=function(k){this.$ConversationNubTabStateClass2.modifyTabState(k,function(l){l.unseenCommentsSinceLastCleared={};l.hasFakeInitBadge=false;l.badgeCount=0;l.isBlinkingUnread=false})};j.prototype.deleteTab=function(k){var l=this.getLoadedTab(k);if(l){delete this.$ConversationNubTabStateClass1[k];l.destroy()}this.$ConversationNubTabStateClass2.remove(k);return Boolean(l)};j.prototype.deleteAllTabs=function(){this.getUnsortedLoadedTabs().forEach(function(k){return this.deleteTab(k.getTabID())}.bind(this))};j.prototype.modifyTabState=function(k,l){return this.$ConversationNubTabStateClass2.modifyTabState(k,l)};j.prototype.moveTabToDockLeft=function(k){var l=this.getLoadedTab(k);if(!l)return;this.$ConversationNubTabStateClass2.modifyTabs(function(m){var n=m.findIndex(function(l){return l.tabID===k});n!==-1||h(0);var o=m[n],p=this.$ConversationNubTabStateClass5(l),q=this.getLoadedTabs().length,r=this.getNumDockTabs();if(p<0||q===0)return m;else if(r===0){if(p!==0){m.splice(n,1);m.unshift(o)}return m}var s=r-1;if(p===s)return m;m.splice(n,1);if(p<s)s-=1;var t=this.getLoadedTabs()[s],u=this.getTabState(t.getTabID());u||h(0);var v=m.findIndex(function(l){return l.tabID===u.tabID});m.splice(v,0,o);return m}.bind(this))};j.prototype.getLoadedTabs=function(){var k=this.$ConversationNubTabStateClass2.getTabs().map(function(l){return this.getLoadedTab(l.tabID)}.bind(this)).filter(Boolean);return k};j.prototype.getUnsortedLoadedTabs=function(){var k=Object.values(this.$ConversationNubTabStateClass1);return k};j.prototype.getTotalTabCount=function(){return this.getUnsortedLoadedTabs().length};j.prototype.getTabsForDockOldestFirst=function(){return this.getLoadedTabs().slice(0,this.getNumDockTabs())};j.prototype.getTabsForDockNewestFirst=function(){return this.getTabsForDockOldestFirst().slice().reverse()};j.prototype.getTabsForMenuOldestFirst=function(){return this.getLoadedTabs().slice(this.getNumDockTabs())};j.prototype.getTabsForMenuNewestFirst=function(){return this.getLoadedTabs().slice(this.getNumDockTabs()).reverse()};j.prototype.$ConversationNubTabStateClass4=function(){var k=this.getLoadedTabs().length;if(k>i){var l=k-i,m=this.getTabsForMenuOldestFirst().slice(0,l);m.map(function(n){return n.getTabID()}).forEach(function(n){return this.deleteTab(n)}.bind(this))}};j.prototype.$ConversationNubTabStateClass5=function(k){return this.getLoadedTabs().indexOf(k)};f.exports=new j()}),null);
__d("ConversationNub",["csx","cx","Arbiter","ConversationNubHeader","ConversationNubTabState","ConversationNubTabsUpdateEventController","ConversationNubUtils","CSS","DOM","EventListener","NotificationUserActions","SubscriptionsHandler","UFIComposerIsTypingStore","URI","containsNode","debounce","guid"],(function a(b,c,d,e,f,g,h,i){"use strict";var j=c("ConversationNubTabsUpdateEventController").minimizeAndInformTabUpdate,k=c("ConversationNubTabsUpdateEventController").popOutAndInformTabUpdate,l=c("ConversationNubTabState"),m=10,n=500,o=100;p.createDefaultState=function(q,r,s,t,u,v){return{tabID:q,permalinkURI:r?new(c("URI"))(r):null,ftID:s,notifAlertID:t,notificationType:u,title:v,keepAtBottom:false,isTabRaised:false,isBlinkingUnread:false,badgeCount:0,allSeenNewComments:{},unseenCommentsSinceLastCleared:{},hasFakeInitBadge:false}};function p(q,r,s,t){var u=arguments.length<=4||arguments[4]===undefined?false:arguments[4],v=arguments.length<=5||arguments[5]===undefined?false:arguments[5];this.$ConversationNub13=false;this.$ConversationNub14=false;this.$ConversationNub1=q;this.$ConversationNub12=r;this.$ConversationNub5=c("guid")();this.$ConversationNub7=null;this.$ConversationNub8=false;this.$ConversationNub9=null;this.$ConversationNub10=u;this.$ConversationNub11=v;this.$ConversationNub15=t;this.$ConversationNub6=new(c("SubscriptionsHandler"))();this.$ConversationNub16();this.$ConversationNub17();if(s!=null)l.modifyTabState(this.$ConversationNub12,function(w){if(s)w.hasFakeInitBadge=false;else{w.hasFakeInitBadge=true;this.$ConversationNub18(1);this.$ConversationNub19(true)}}.bind(this));this.$ConversationNub20()}p.prototype.$ConversationNub20=function(){this.$ConversationNub21();this.$ConversationNub22();c("ConversationNubUtils").informShouldRecheckTabVisibility(this);this.forceReflow()};p.prototype.getPersistentState=function(){return l.getTabState(this.$ConversationNub12)};p.prototype.getPersistentStateIfExists=function(){return l.getTabStateIfExists(this.$ConversationNub12)};p.prototype.$ConversationNub16=function(){var q=this.$ConversationNub23();if(q){this.$ConversationNub6.addSubscriptions(c("EventListener").listen(q,"click",this.$ConversationNub24.bind(this)),c("EventListener").listen(q,"mouseenter",this.$ConversationNub25.bind(this)),c("EventListener").listen(q,"mouseleave",this.$ConversationNub26.bind(this)));var r=c("ConversationNubUtils").getCloseButtonElem(q);if(r)c("ConversationNubUtils").addCloseButtonListeners(r,this.$ConversationNub6,this.$ConversationNub27.bind(this))}var s=this.$ConversationNub28();if(s){l.modifyTabState(this.$ConversationNub12,function(u){u.keepAtBottom=true});this.$ConversationNub6.addSubscriptions(c("EventListener").listen(s,"scroll",c("debounce")(this.$ConversationNub29.bind(this),o)),c("Arbiter").subscribe("reflow",this.$ConversationNub30.bind(this)))}var t=this.$ConversationNub31();if(t)this.$ConversationNub6.addSubscriptions(c("EventListener").listen(t,"focusin",this.$ConversationNub32.bind(this,true)),c("EventListener").listen(t,"focusout",this.$ConversationNub32.bind(this,false)))};p.prototype.$ConversationNub17=function(){var q=this.$ConversationNub33();if(!q){this.$ConversationNub2=null;return}var r=function(){var t=this.getPersistentState();return{permalinkURI:t.permalinkURI,ftID:t.ftID,tabID:t.tabID}}.bind(this),s=new(c("ConversationNubHeader"))(q,r);this.$ConversationNub6.addSubscriptions(s.subscribe("closeButton",this.$ConversationNub27.bind(this)),s.subscribe("showMenu",this.$ConversationNub34.bind(this)),s.subscribe("hideMenu",this.$ConversationNub35.bind(this)),s.subscribe("minimizeButton",this.$ConversationNub36.bind(this,true)),s.subscribe("clickHeader",this.$ConversationNub36.bind(this,true)),s.subscribe("menuPermalinkClick",this.$ConversationNub36.bind(this,false)),c("UFIComposerIsTypingStore").addListener(function(){var t=this.getPersistentStateIfExists();if(!t)return;var u=this.$ConversationNub14,v=c("UFIComposerIsTypingStore").getValueFor(t.ftID);this.$ConversationNub14=v===true;if(u!==this.$ConversationNub14)c("ConversationNubTabsUpdateEventController").informTabsUpdated()}.bind(this)));this.$ConversationNub2=s};p.prototype.$ConversationNub33=function(){return this.$ConversationNub1&&c("DOM").scry(this.$ConversationNub1,".fbNubFlyoutTitlebar")[0]};p.prototype.$ConversationNub23=function(){return this.$ConversationNub1&&c("DOM").scry(this.$ConversationNub1,".fbNubButton")[0]};p.prototype.$ConversationNub28=function(){if(!this.$ConversationNub3&&this.$ConversationNub1)this.$ConversationNub3=c("DOM").scry(this.$ConversationNub1,".uiScrollableAreaWrap")[0];return this.$ConversationNub3};p.prototype.$ConversationNub31=function(){if(!this.$ConversationNub4&&this.$ConversationNub1)this.$ConversationNub4=c("DOM").scry(this.$ConversationNub1,".fbNubFlyoutBodyContent")[0];return this.$ConversationNub4};p.prototype.$ConversationNub37=function(){var q=this.$ConversationNub23();if(q)return c("DOM").scry(q,"._37op")[0];return null};p.prototype.$ConversationNub27=function(){c("ConversationNubUtils").informShouldCloseTab(this.$ConversationNub12,this.getFeedbackTargetID(),c("ConversationNubUtils").CLOSE_REASON_TAB_X_OUT)};p.prototype.$ConversationNub36=function(q){j(this,q)};p.prototype.$ConversationNub34=function(){this.$ConversationNub1&&c("CSS").addClass(this.$ConversationNub1,"_1uw3")};p.prototype.$ConversationNub35=function(){this.$ConversationNub1&&c("CSS").removeClass(this.$ConversationNub1,"_1uw3")};p.prototype.$ConversationNub24=function(){if(this.getPersistentState().isTabRaised)j(this,true);else k(this,true)};p.prototype.$ConversationNub25=function(){if(this.getPersistentState().isBlinkingUnread)this.$ConversationNub9=new Date()};p.prototype.$ConversationNub26=function(){var q=this.$ConversationNub9;if(q&&this.getPersistentState().isBlinkingUnread){var r=new Date();if(r-q>=n)this.$ConversationNub19(false)}this.$ConversationNub9=null};p.prototype.$ConversationNub38=function(){var q=this.$ConversationNub28();if(q){var r=q.scrollHeight;if(r>0&&!this.$ConversationNub39(q)){this.$ConversationNub8=true;q.scrollTop=r}}};p.prototype.$ConversationNub39=function(q){q=q||this.$ConversationNub28();return!!(q&&q.scrollTop>=q.scrollHeight-q.clientHeight-m)};p.prototype.$ConversationNub29=function(){if(!l.getTabStateIfExists(this.$ConversationNub12)||!this.getPersistentState().isTabRaised)return;l.modifyTabState(this.$ConversationNub12,function(q){q.keepAtBottom=this.$ConversationNub39();c("ConversationNubUtils").informShouldRecheckTabVisibility(this)}.bind(this));if(!this.$ConversationNub8)this.clearJewelNotifications();this.$ConversationNub8=false};p.prototype.$ConversationNub32=function(q){if(this.$ConversationNub13===q)return;this.$ConversationNub13=q;if(this.$ConversationNub13)this.clearJewelNotifications();c("ConversationNubTabsUpdateEventController").informTabsUpdated()};p.prototype.getIsFocused=function(){return this.$ConversationNub13};p.prototype.getPageID=function(){return this.$ConversationNub15};p.prototype.getHasText=function(){return this.$ConversationNub14};p.prototype.$ConversationNub30=function(){var q=this.getPersistentState();if(!q.isTabRaised)return;if(q.keepAtBottom){this.$ConversationNub38();this.$ConversationNub7&&clearTimeout(this.$ConversationNub7);this.$ConversationNub7=setTimeout(function(){if(q.keepAtBottom)this.$ConversationNub38()}.bind(this),100)}};p.prototype.$ConversationNub18=function(q){l.modifyTabState(this.$ConversationNub12,function(r){r.badgeCount=q;this.$ConversationNub21()}.bind(this))};p.prototype.$ConversationNub19=function(q){l.modifyTabState(this.$ConversationNub12,function(r){r.isBlinkingUnread=q;this.$ConversationNub22()}.bind(this))};p.prototype.$ConversationNub21=function(){var q=this.$ConversationNub37();if(!q)return;var r=this.getPersistentState().badgeCount,s=r>0;if(s){c("DOM").setContent(q,r);c("CSS").show(q)}else{c("CSS").hide(q);c("DOM").setContent(q,r)}};p.prototype.$ConversationNub22=function(){if(this.$ConversationNub1){var q=this.getPersistentState().isBlinkingUnread;if(this.$ConversationNub1)c("CSS").conditionClass(this.$ConversationNub1,"_53tf",q)}};p.prototype.getRootDOM=function(){return this.$ConversationNub1};p.prototype.getShouldShowIntroNux=function(){return this.$ConversationNub10};p.prototype.getShouldShowHideNux=function(){return this.$ConversationNub11};p.prototype.getTabID=function(){return this.$ConversationNub12};p.prototype.getNotificationPayloadAlertID=function(){return this.getPersistentState().notifAlertID};p.prototype.getNotificationType=function(){return this.getPersistentState().notificationType};p.prototype.setNotificationType=function(q){l.modifyTabState(this.$ConversationNub12,function(r){r.notificationType=q})};p.prototype.getFeedbackTargetID=function(){return this.getPersistentState().ftID};p.prototype.getPermalinkURI=function(){return this.getPersistentState().permalinkURI};p.prototype.getTitle=function(){return this.getPersistentState().title};p.prototype.getBadgeCount=function(){return this.getPersistentState().badgeCount};p.prototype.getIsRaised=function(){return this.getPersistentState().isTabRaised};p.prototype.getSessionID=function(){return this.$ConversationNub5};p.prototype.markCommentsAsSeenWithoutBadging=function(q){l.modifyTabState(this.$ConversationNub12,function(r){q.forEach(function(s){r.allSeenNewComments[s]=true})})};p.prototype.attemptAddNewCommentsToBadge=function(q){l.modifyTabState(this.$ConversationNub12,function(r){q.forEach(function(u){if(r.allSeenNewComments[u])return;r.allSeenNewComments[u]=true;r.unseenCommentsSinceLastCleared[u]=true});var s=Object.keys(r.unseenCommentsSinceLastCleared).length;if(r.hasFakeInitBadge)s+=1;var t=r.badgeCount;this.$ConversationNub18(s);this.$ConversationNub19(s>0&&s>t)}.bind(this))};p.prototype.clearBadge=function(){l.clearTabNotifications(this.$ConversationNub12);this.$ConversationNub21();this.$ConversationNub22()};p.prototype.clearJewelNotifications=function(){var q=this.getNotificationPayloadAlertID();if(q)c("NotificationUserActions").markNotificationsAsRead([q])};p.prototype.popOutAndInformTabUpdate=function(){this.popOut();c("ConversationNubTabsUpdateEventController").informTabsUpdated()};p.prototype.popOut=function(){l.modifyTabState(this.$ConversationNub12,function(q){if(this.$ConversationNub1)c("CSS").addClass(this.$ConversationNub1,"_5r93");q.isTabRaised=true;this.clearBadge();if(q.keepAtBottom)this.$ConversationNub38()}.bind(this))};p.prototype.minimize=function(){l.modifyTabState(this.$ConversationNub12,function(q){if(this.$ConversationNub1)c("CSS").removeClass(this.$ConversationNub1,"_5r93");q.isTabRaised=false;this.$ConversationNub2&&this.$ConversationNub2.hideMenu();this.clearBadge()}.bind(this))};p.prototype.forceReflow=function(){this.$ConversationNub30()};p.prototype.isFormForThisUFI=function(q){return this.$ConversationNub1&&c("containsNode")(this.$ConversationNub1,q)};p.prototype.destroy=function(){this.$ConversationNub6.release();this.$ConversationNub2&&this.$ConversationNub2.destroy();this.$ConversationNub2=null;this.$ConversationNub7&&clearTimeout(this.$ConversationNub7);this.minimize();if(this.$ConversationNub1){c("DOM").remove(this.$ConversationNub1);c("Arbiter").inform("ConversationNub/destroy",{root:this.$ConversationNub1});this.$ConversationNub1=null}};f.exports=p}),null);
__d("ConversationNubAddCommentSubscription",["Arbiter","ConversationNubTabState","UFIUIEvents"],(function a(b,c,d,e,f,g){"use strict";function h(i){return c("Arbiter").subscribe(c("UFIUIEvents").Comment,function(j,k){var l=k.ft_id,m=k.form;if(!l||!m)return;var n=c("ConversationNubTabState").getLoadedTabByFeedbackTarget(l);if(n&&n.isFormForThisUFI(m))i(n,l)})}f.exports={subscribe:h}}),null);
__d("XConversationNubActionTakenController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/ajax/conversation/nub_story/action_taken/",{})}),null);
__d("ConversationNubActionTakenReporter",["Arbiter","AsyncRequest","ConversationNubAddCommentSubscription","ConversationNubUtils","PinnedConversationNubsActionTaken","SubscriptionsHandler","XConversationNubActionTakenController"],(function a(b,c,d,e,f,g){"use strict";function h(){this.$ConversationNubActionTakenReporter2=function(i,j){this.$ConversationNubActionTakenReporter4(j,c("PinnedConversationNubsActionTaken").COMMENT_ADDED)}.bind(this);this.$ConversationNubActionTakenReporter3=function(event,i){var j=i.tabID,k=i.ftID,l=i.tabState,m=i.sessionID,n=i.reason;if(n===c("ConversationNubUtils").CLOSE_REASON_TAB_X_OUT||n===c("ConversationNubUtils").CLOSE_REASON_OVERFLOW_X_OUT||n===c("ConversationNubUtils").CLOSE_REASON_UNPIN)this.$ConversationNubActionTakenReporter4(k,c("PinnedConversationNubsActionTaken").TAB_CLOSED_BY_USER)}.bind(this);this.$ConversationNubActionTakenReporter1=new(c("SubscriptionsHandler"))(c("ConversationNubAddCommentSubscription").subscribe(this.$ConversationNubActionTakenReporter2),c("Arbiter").subscribe(c("ConversationNubUtils").CLOSE_TAB_EVENT,this.$ConversationNubActionTakenReporter3))}h.prototype.destroy=function(){this.$ConversationNubActionTakenReporter1.release()};h.prototype.$ConversationNubActionTakenReporter4=function(i,j){var k=c("XConversationNubActionTakenController").getURIBuilder().getURI();new(c("AsyncRequest"))().setURI(k).setMethod("POST").setData({ft_id:i,action:j}).setAllowCrossPageTransition(true).send()};f.exports=h}),null);
__d("ConversationNubHeader",["csx","ArbiterMixin","Bootloader","ConversationNubUtils","DOM","Event","EventListener","Keys","SubscriptionsHandler","ifRequired","mixin"],(function a(b,c,d,e,f,g,h){"use strict";var i,j;function k(m,n){return c("EventListener").listen(m,"keydown",function(o){if(c("Event").getKeyCode(o)===c("Keys").RETURN)n(o)})}i=babelHelpers.inherits(l,c("mixin")(c("ArbiterMixin")));j=i&&i.prototype;function l(m,n){j.constructor.call(this);this.$ConversationNubHeader6=false;this.$ConversationNubHeader1=m;this.$ConversationNubHeader3=n;this.$ConversationNubHeader4=null;this.$ConversationNubHeader5=false;this.$ConversationNubHeader2=new(c("SubscriptionsHandler"))();this.$ConversationNubHeader7()}l.prototype.$ConversationNubHeader7=function(){var m=this.$ConversationNubHeader1;this.$ConversationNubHeader2.addSubscriptions(c("EventListener").listen(m,"click",this.$ConversationNubHeader8.bind(this)));var n=c("ConversationNubUtils").getCloseButtonElem(m);if(n)c("ConversationNubUtils").addCloseButtonListeners(n,this.$ConversationNubHeader2,this.$ConversationNubHeader9.bind(this));var o=this.$ConversationNubHeader10();if(o)this.$ConversationNubHeader2.addSubscriptions(c("EventListener").listen(o,"click",this.$ConversationNubHeader11.bind(this)),k(o,this.$ConversationNubHeader11.bind(this)));var p=this.$ConversationNubHeader12();if(p)this.$ConversationNubHeader2.addSubscriptions(c("EventListener").listen(p,"click",this.$ConversationNubHeader13.bind(this)),c("EventListener").listen(p,"mouseover",this.$ConversationNubHeader14.bind(this)),c("EventListener").listen(p,"focus",this.$ConversationNubHeader15.bind(this)),k(p,this.$ConversationNubHeader16.bind(this)))};l.prototype.$ConversationNubHeader12=function(){return c("DOM").scry(this.$ConversationNubHeader1,"._1rf1")[0]};l.prototype.$ConversationNubHeader10=function(){return c("DOM").scry(this.$ConversationNubHeader1,"._4a56")[0]};l.prototype.$ConversationNubHeader17=function(){return c("ConversationNubUtils").getCloseButtonElem(this.$ConversationNubHeader1)};l.prototype.$ConversationNubHeader9=function(){this.inform("closeButton")};l.prototype.$ConversationNubHeader11=function(m){if(m.type==="click")m.kill();this.inform("minimizeButton")};l.prototype.$ConversationNubHeader8=function(){this.inform("clickHeader")};l.prototype.$ConversationNubHeader18=function(){this.inform("showMenu")};l.prototype.$ConversationNubHeader19=function(){this.inform("hideMenu");var m=this.$ConversationNubHeader12();m&&m.blur()};l.prototype.$ConversationNubHeader20=function(){this.inform("menuPermalinkClick")};l.prototype.$ConversationNubHeader21=function(m){if(this.$ConversationNubHeader4)return;var n=this.$ConversationNubHeader12();if(!n)return;if(m)this.$ConversationNubHeader5=true;c("Bootloader").loadModules(["React","ReactDOM","ConversationNubHeaderMenu.react"],function(o,p,q){if(this.$ConversationNubHeader6)return;var r=babelHelpers["extends"]({},this.$ConversationNubHeader3(),{onMenuShow:this.$ConversationNubHeader18.bind(this),onMenuHide:this.$ConversationNubHeader19.bind(this),onPermalinkClick:this.$ConversationNubHeader20.bind(this),showOnMount:this.$ConversationNubHeader5});this.$ConversationNubHeader4=p.render(o.createElement(q,r),n)}.bind(this),"ConversationNubHeader")};l.prototype.$ConversationNubHeader13=function(m){m.kill();this.$ConversationNubHeader21(true)};l.prototype.$ConversationNubHeader14=function(){this.$ConversationNubHeader21(false)};l.prototype.$ConversationNubHeader15=function(){this.$ConversationNubHeader21(false)};l.prototype.$ConversationNubHeader16=function(){if(this.$ConversationNubHeader4)this.$ConversationNubHeader4.toggle();else this.$ConversationNubHeader21(true)};l.prototype.hideMenu=function(){this.$ConversationNubHeader4&&this.$ConversationNubHeader4.hide()};l.prototype.destroy=function(){this.$ConversationNubHeader6=true;var m=this.$ConversationNubHeader12();if(m&&this.$ConversationNubHeader4)c("ifRequired")("ReactDOM",function(n){n.unmountComponentAtNode(m)});this.$ConversationNubHeader2.release()};f.exports=l}),null);
__d("ConversationNubTabsUpdateEventController",["Arbiter","ConversationNubUtils"],(function a(b,c,d,e,f,g){"use strict";var h="ConversationNub/tabsUpdated",i="ConversationNub/minimizedByUser",j="ConversationNub/maximizedByUser",k=false;function l(p){if(!k)c("Arbiter").inform(h,p)}function m(p){return c("Arbiter").subscribe(h,function(q,r){k=true;p(r);k=false})}function n(p,q){q&&c("Arbiter").inform(i,{tab:p});p.minimize();l()}function o(p,q){if(!q&&!c("ConversationNubUtils").allowProgrammaticPopOut())return;q&&c("Arbiter").inform(j,{tab:p});p.popOut();l()}f.exports={TAB_MINIMIZED_BY_USER_EVENT:i,TAB_MAXIMIZED_BY_USER_EVENT:j,informTabsUpdated:l,subscribeToTabsUpdated:m,minimizeAndInformTabUpdate:n,popOutAndInformTabUpdate:o}}),null);
__d("XConversationNubTogglePinController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/ajax/conversation/nub_story/toggle_pin/",{ft_id:{type:"String"},pin:{type:"Bool",defaultValue:false},with_render:{type:"Bool",defaultValue:false},notif_setting:{type:"Enum",enumType:1}})}),null);
__d("XConversationsToggleController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/ajax/conversation/toggle_feature/",{turn_conversations_on:{type:"Bool",defaultValue:false}})}),null);
__d("isBusinessURI",["isFacebookURI"],(function a(b,c,d,e,f,g){"use strict";function h(i){return c("isFacebookURI")(i)&&i.getSubdomain()==="business"}f.exports=h}),null);
__d("isGamesURI",["isFacebookURI"],(function a(b,c,d,e,f,g){"use strict";function h(i){return c("isFacebookURI")(i)&&i.getPath().startsWith("/games")}f.exports=h}),null);
__d("ConversationNubUtils",["csx","Arbiter","AsyncFeature","AsyncRequest","ConversationNubTabState","DOM","Event","EventListener","Keys","NotificationConversationController","URI","XConversationNubTogglePinController","XConversationsToggleController","isBusinessURI","isCanvasAppURI","isGamesURI"],(function a(b,c,d,e,f,g,h){"use strict";var i=c("ConversationNubTabState"),j={DISABLE:"disable",ENABLE:"enable"},k="ConversationNubUtils/closeTab",l="ConversationNubUtils/unpinnedFromHeader",m="ConversationNubUtils/recheckTabVisibility",n="ConversationNubUtils/openPermalinkFromHeader",o="ConversationNubUtils/turnOff",p="ConversationNubUtils/turnOn",q="tab-x-out",r="browser-tab-sync",s="overflow-x-out",t="unpin";function u(O){var P=Object.values(j);return P.find(function(Q){return Q===O})||null}function v(O,P,Q,R){var S=R||{},T=S.notif_setting,U=c("XConversationNubTogglePinController").getURIBuilder().setString("ft_id",String(O)).setBool("pin",P);if(T&&c("AsyncFeature").__serverHasFeatureImpl(3))U.setEnum("notif_setting",T);var V=U.getURI(),W=new(c("AsyncRequest"))().setURI(V).setMethod("POST");if(Q)W.setAllowCrossPageTransition(true);W.send()}function w(E){var O=c("XConversationsToggleController").getURIBuilder().setBool("turn_conversations_on",E).getURI();E?N():M();var P=new(c("AsyncRequest"))().setURI(O).setAllowCrossPageTransition(true).setHandler(function(Q){if(Q.getPayload().conversationsStatus)N();else M()}).setErrorHandler(function(Q){E?M():N()}).setMethod("POST");P.send()}function x(O,P,Q){v(O,true,P,Q)}function y(O,P,Q){v(O,false,P,Q)}function z(O,P){x(O,false,P)}function A(O,P){y(O,false,P)}function B(O,P){x(O,true,P)}function C(O,P){y(O,true,P)}function D(){w(false);c("NotificationConversationController").deleteAllTabs()}function E(){w(true)}function F(O){return c("DOM").scry(O,"._4iz6")[0]}function G(O,P,Q){var R=function R(){Q()};P.addSubscriptions(c("EventListener").listen(O,"click",R),c("EventListener").listen(O,"keydown",function(S){if(c("Event").getKeyCode(S)===c("Keys").RETURN)R()}))}function H(){var O=c("URI").getRequestURI();return!c("isCanvasAppURI")(O)&&!c("isBusinessURI")(O)&&!c("isGamesURI")(O)}function I(O,P,Q){var R=i.getLoadedTab(O);if(!R)return;var S=R.getPersistentState(),T=R.getSessionID(),U=R.getPageID();c("Arbiter").inform(k,{tabID:O,ftID:P,tabState:S,sessionID:T,reason:Q,pageID:U})}function J(O){var P=i.getLoadedTab(O);if(!P)return;c("Arbiter").inform(l,{tab:P})}function K(O){c("Arbiter").inform(m,{tab:O})}function L(O){var P=i.getLoadedTab(O);if(!P)return;c("Arbiter").inform(n,{tab:P})}function M(){c("Arbiter").inform(o,{})}function N(){c("Arbiter").inform(p,{})}f.exports={CLOSE_TAB_EVENT:k,UNPIN_FROM_HEADER_EVENT:l,OPEN_PERMALINK_FROM_HEADER_EVENT:n,TURN_CONVERSATIONS_OFF_EVENT:o,TURN_CONVERSATIONS_ON_EVENT:p,CLOSE_REASON_TAB_X_OUT:q,CLOSE_REASON_SYNCHRONIZED_FROM_OTHER_TAB:r,CLOSE_REASON_OVERFLOW_X_OUT:s,CLOSE_REASON_UNPIN:t,coerceToPinRequestNotifSetting:u,sendPinRequest:z,sendUnpinRequest:A,sendPinRequestAcrossTransitions:B,sendUnpinRequestAcrossTransitions:C,getCloseButtonElem:F,addCloseButtonListeners:G,informShouldCloseTab:I,informDidUnpinFromHeaderMenu:J,informShouldRecheckTabVisibility:K,informOpenPermalinkFromHeader:L,allowProgrammaticPopOut:H,turnConversationsOff:D,turnConversationsOn:E}}),null);
__d("ConversationNubPermalinkUtils",["URI","isFacebookURI"],(function a(b,c,d,e,f,g){"use strict";function h(l){return l.substr(-1)==="/"?l.slice(0,-1):l}function i(l,m){var n=l.getPath(),o=m.getPath();return h(n)===h(o)}function j(l,m,n){var o=l.getQueryData(),p=m.getQueryData(),q=o[n],r=p[n];if(q==null&&r==null)return true;return q===r}function k(l){var m=new(c("URI"))(window.location.href);return m&&l&&c("isFacebookURI")(m)&&c("isFacebookURI")(l)&&i(m,l)&&j(m,l,"fbid")&&j(m,l,"story_fbid")}f.exports={isOnPermalink:k}}),null);
__d("ConversationNubViewportManager",["DockTabsViewportCalculator","DockTabsViewportPinnedConversationTabUtils"],(function a(b,c,d,e,f,g){"use strict";var h=c("DockTabsViewportPinnedConversationTabUtils").getMinRequiredWidthForFirstConvoTab;function i(j,k,l){this.$ConversationNubViewportManager1=j;this.$ConversationNubViewportManager3=k;this.$ConversationNubViewportManager2=c("DockTabsViewportCalculator").getInstance(this.$ConversationNubViewportManager1);this.$ConversationNubViewportManager2&&this.$ConversationNubViewportManager2.registerPinnedConvoTabCallbacks(babelHelpers["extends"]({},l,{pinnedConvoTabStateGetter:function(){return this.$ConversationNubViewportManager3}.bind(this)}))}i.prototype.getNumDockTabsToShow=function(j){return this.getCouldFitAtLeastOneDockTab(j)?1:0};i.prototype.getCouldFitAtLeastOneDockTab=function(j){var k=h();return k<=j};i.prototype.forceRecalculatePinnedConvoTabs=function(j){this.$ConversationNubViewportManager2&&this.$ConversationNubViewportManager2.forceRecalculatePinnedConvoTabs(j)};f.exports=i}),null);
__d("ConversationNubVisibilityDedupeUtils",["Bootloader","emptyFunction","ifRequired"],(function a(b,c,d,e,f,g){"use strict";function h(j){c("Bootloader").loadModules(["UFICommentVisibilityStore"],j,"ConversationNubVisibilityDedupeUtils")}function i(j){return c("ifRequired")("UFICommentVisibilityStore",function(k){return k.isFeedbackTargetVisible(j)},c("emptyFunction").thatReturnsFalse)}f.exports={bootloadUFIVisibilityModule:h,isFeedbackTargetVisible:i}}),null);
__d("XNotificationNubStoryController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/conversation/nub_story/",{notif_alert_id:{type:"String"},notif_id:{type:"Int"},ft_id:{type:"String"},force_minimized:{type:"Bool",defaultValue:false}})}),null);
__d("NotificationConversationController",["csx","cx","Arbiter","AsyncRequest","Bootloader","ConversationNub","ConversationNubActionTakenReporter","ConversationNubPermalinkUtils","ConversationNubTabState","ConversationNubTabsUpdateEventController","ConversationNubUtils","ConversationNubViewportManager","ConversationNubVisibilityDedupeUtils","CSS","DOM","PinnedConversationNubsConfig","SubscriptionsHandler","URI","XNotificationNubStoryController","ge","ifRequired","nullthrows"],(function a(b,c,d,e,f,g,h,i){"use strict";var j=c("ConversationNubVisibilityDedupeUtils").isFeedbackTargetVisible,k=1,l=c("ConversationNubTabState"),m=Object.create(null),n=null,o=null,p=null,q=null,r=null,s=null,t=false,u=null,v=null,w=null,x=null,y=Object.create(null);function z(){if(!o)o=c("DOM").scry(c("ge")("pagelet_dock"),"._1mw-")[0];return o}function A(){if(!p){var D=z();if(D)p=c("DOM").scry(D,"._1tvj")[0]}return p}function B(){if(!q){var D=z();if(D)q=c("DOM").scry(D,"._2ikx .fbNubButton")[0]}return q}C.prototype.init=function(){if(t)return;t=true;var D=new(c("SubscriptionsHandler"))();D.addSubscriptions(c("ConversationNubTabsUpdateEventController").subscribeToTabsUpdated(this.$NotificationConversationController2.bind(this)),c("Arbiter").subscribe(c("ConversationNubUtils").CLOSE_TAB_EVENT,function(E,F){var G=F||{},H=G.tabID;if(H)this.$NotificationConversationController3(H)}.bind(this)));this.$NotificationConversationController1=new(c("ConversationNubActionTakenReporter"))();u=D};C.prototype.$NotificationConversationController4=function(D){var E=n?n.getNumDockTabsToShow(D):k;l.setMaxDockTabs(E)};C.prototype.$NotificationConversationController5=function(D,E){this.$NotificationConversationController4(D);if(E){var F=E.tabToPromote,G=E.tabToOpenIfInDock;if(F&&!l.isTabInDock(F.getTabID()))l.moveTabToDockLeft(F.getTabID());if(c("ConversationNubUtils").allowProgrammaticPopOut()&&G&&l.isTabInDock(G.getTabID()))G.popOut()}this.$NotificationConversationController6(D)};C.prototype.$NotificationConversationController2=function(D){n&&n.forceRecalculatePinnedConvoTabs(D)};C.prototype.$NotificationConversationController6=function(D){var E=l.getTotalTabCount(),F=l.getNumDockTabs(),G=n?n.getCouldFitAtLeastOneDockTab(D):false,H=E>0&&G,I=F<E&&H,J=z();if(J){c("CSS").conditionClass(J,"_1tvf",H);c("CSS").conditionClass(J,"_1dex",I);c("CSS").conditionClass(J,"_1tvi",I)}var K=c("PinnedConversationNubsConfig").pinnedToLeft?l.getTabsForDockOldestFirst():l.getTabsForDockNewestFirst();K.forEach(function(M){if(M.getIsRaised())M.clearBadge()});var L=l.getTabsForMenuNewestFirst();this.$NotificationConversationController7(K);this.$NotificationConversationController8(L)};C.prototype.handleNotificationsRead=function(D){this.init();l.getUnsortedLoadedTabs().forEach(function(F){var G=F.getNotificationPayloadAlertID();if(G&&D[G])F.clearBadge()});l.getUnloadedTabs().forEach(function(F){if(F.notifAlertID&&D[F.notifAlertID])l.clearTabNotifications(F.tabID)});var E=l.getTabsForMenuNewestFirst();this.$NotificationConversationController8(E)};C.prototype.handleNewNotificationFromGraphQL=function(D,E){this.init();var F=c("nullthrows")(D),G=F.tab_id,H=F.notification,I=F.feedback_target_id,J=F.permalink_uri,K=c("nullthrows")(H),L=K.notif_id,M=K.alert_id,N=K.notif_type;this.$NotificationConversationController9(c("nullthrows")(G),c("nullthrows")(L),c("nullthrows")(I),c("nullthrows")(M),J?new(c("URI"))(J):null,E,N)};C.prototype.handleNewNotificationsFromChannel=function(D,E){this.init();D.forEach(function(F){var G=F.alert_id,H=F.pinnedConvoConfig,I=F.tracking,J=F.notif_type;if(!H)return;var K=H.tab_id,L=H.ft_id,M=H.permalink_uri,N=JSON.parse(I),O=M?new(c("URI"))(M):null;this.$NotificationConversationController9(K,N.alert_id,L,G,O,E,J)}.bind(this))};C.prototype.$NotificationConversationController9=function(D,E,F,G,H,I,J){var K=c("XNotificationNubStoryController").getURIBuilder().setString("notif_alert_id",G).setInt("notif_id",E);this.$NotificationConversationController10(F,I);this.$NotificationConversationController11(D,F,J,H,K)};C.prototype.$NotificationConversationController10=function(D,E){if(!y[D])y[D]=E};C.prototype.requestPersistedStory=function(D,E,F,G){this.$NotificationConversationController10(E,G);var H=c("XNotificationNubStoryController").getURIBuilder().setString("ft_id",E);this.$NotificationConversationController11(D,E,null,F,H)};C.prototype.$NotificationConversationController11=function(D,E,F,G,H){if(m[D])return;var I=l.getLoadedTab(D);if(I){if(F)I.setNotificationType(F);return}if(c("ConversationNubPermalinkUtils").isOnPermalink(G)||j(E))H.setBool("force_minimized",true);m[D]=true;new(c("AsyncRequest"))().setURI(H.getURI()).setAllowCrossPageTransition(true).setFinallyHandler(function(){delete m[D]}).send()};C.prototype.$NotificationConversationController12=function(D){var E=true;l.getUnsortedLoadedTabs().forEach(function(F){var G=F.getFeedbackTargetID(),H=D[G],I=H?Object.keys(H):[];if(I.length){var J=F.getBadgeCount();if(j(G)){F.markCommentsAsSeenWithoutBadging(I);F.clearBadge()}else F.attemptAddNewCommentsToBadge(I);var K=F.getBadgeCount();if(J!==K)E=true}});if(E)c("ConversationNubTabsUpdateEventController").informTabsUpdated()};C.prototype.$NotificationConversationController13=function(D){if(x)return;c("Bootloader").loadModules(["ConversationNubSurveys"],function(E){if(!x)x=new E(D)},"NotificationConversationController")};C.prototype.$NotificationConversationController14=function(D,E,F){if(w){w.addTab(D,F);delete y[D.getPersistentState().ftID];return}c("Bootloader").loadModules(["ConversationNubLogger"],function(G){if(!w)w=new G(E);w.addTab(D,F);delete y[D.getPersistentState().ftID]},"NotificationConversationController")};C.prototype.$NotificationConversationController15=function(){if(v)return;c("Bootloader").loadModules(["ConversationNubUFICentralUpdateManager"],function(D){if(v)return;v=new D(this.$NotificationConversationController12.bind(this))}.bind(this),"NotificationConversationController")};C.prototype.$NotificationConversationController7=function(D){var E=A();if(!E)return;c("Bootloader").loadModules(["React","ReactDOM","ConversationNubDockedTabGroup.react"],function(F,G,H){s=G.render(F.createElement(H,{dockTabs:D}),E)},"NotificationConversationController")};C.prototype.$NotificationConversationController16=function(D){D.popOut();c("ConversationNubTabsUpdateEventController").informTabsUpdated({tabToPromote:D})};C.prototype.$NotificationConversationController8=function(D){var E=B();if(!E)return;c("Bootloader").loadModules(["React","ReactDOM","ConversationNubCollapsedSelectorMenu.react"],function(F,G,H){r=G.render(F.createElement(H,{menuTabs:D,onTabSelected:this.$NotificationConversationController16}),E)}.bind(this),"NotificationConversationController")};C.prototype.$NotificationConversationController17=function(){if(!n){var D=z();if(D){var E={onAvailableWidthChanged:this.$NotificationConversationController5.bind(this)};n=new(c("ConversationNubViewportManager"))(D,l,E)}}};C.prototype.storyFromServer=function(D,E){if(!t)this.init();var F=E.attempt_open_on_init,G=E.ft_id,H=E.init_without_badge,I=E.notif_alert_id,J=E.notification_type,K=E.permalink_uri,L=E.promote_on_init,M=E.tab_add_source,N=E.tab_id,O=E.title,P=E.should_show_intro_nux,Q=E.should_show_hide_nux,R=E.page_id,S=l.getLoadedTab(N);if(S){if(L||F)c("ConversationNubTabsUpdateEventController").informTabsUpdated({tabToPromote:L?S:null,tabToOpenIfInDock:F?S:null});return}H=H||j(G);var T=l.getTabStateIfExists(N);if(T)H=null;else{var U=c("ConversationNub").createDefaultState(N,K,G,I,J,O);l.addTabState(U)}var V=new(c("ConversationNub"))(D,N,H,R,Boolean(P),Boolean(Q));l.addLoadedTab(N,V);F=F||V.getPersistentState().isTabRaised;this.$NotificationConversationController15();this.$NotificationConversationController17();c("ConversationNubTabsUpdateEventController").informTabsUpdated({tabToPromote:L?V:null,tabToOpenIfInDock:F?V:null});this.$NotificationConversationController13(l);var W=y[G]||M||"unknown";this.$NotificationConversationController14(V,l,W)};C.prototype.deleteAllTabs=function(){l.deleteAllTabs();c("ConversationNubTabsUpdateEventController").informTabsUpdated()};C.prototype.$NotificationConversationController3=function(D){var E=l.deleteTab(D);if(E)c("ConversationNubTabsUpdateEventController").informTabsUpdated()};C.prototype.unsubscribe=function(){u&&u.release();u=null;w&&w.destroy();w=null;x&&x.destroy();x=null;v&&v.destroy();v=null;this.$NotificationConversationController1.destroy();c("ifRequired")("ReactDOM",function(D){var E=B();if(r&&E)D.unmountComponentAtNode(E);var F=A();if(s&&F)D.unmountComponentAtNode(F)})};function C(){}f.exports=new C()}),null);