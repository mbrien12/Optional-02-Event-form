if (self.CavalryLogger) { CavalryLogger.start_js(["SoBoS"]); }

__d("NotificationUpNextStore",["Arbiter","CurrentUser","NotificationBucketStore","NotificationSeenState","NotificationStore","PageTransitions","URI"],(function a(b,c,d,e,f,g){"use strict";var h="notification-up-next-updated",i=60*60*24*3,j="notification_clicked",k=i,l=null,m=null,n=null,o=null,p=function p(A){return!c("NotificationBucketStore").isEmptyBucketListData()?c("NotificationBucketStore").getBucketListData().reduce(function(B,C){return B.concat(C.ids)},[]):Object.keys(c("NotificationStore").getAll(A))},q=function q(A){return p(A).filter(function(B){return!c("NotificationSeenState").isRead(B)})},r=function r(A,B){var C=q(B),D=C.indexOf(A),E=C[0],F=C[D+1];return F||(E!==A?E:null)},s=function s(A){if(Date.now()/1e3-A.creation_time>k)return false;return true},t=function t(A){var B=A.getQueryData(),C=B.notif_id;if(!C)return null;return c("CurrentUser").getID()+":"+C},u=function u(A){return A.getUnqualifiedURI().setQueryData({}).toString()==="/photo.php"||Object.prototype.hasOwnProperty.call(A.getQueryData(),"theater")};c("Arbiter").subscribe(j,function(A,B){var C=B.alertID,D=B.endpointConfig;n=C;l=r(n,D);m=l?p(D).indexOf(l):null;c("PageTransitions").registerHandler(v)});var v=function v(A){var B=t(A);if(!B||n!==B)return;if(u(A))return;if(o==="click")x();else c("PageTransitions").registerCompletionCallback(w)},w=function w(){if(!n)return;var A=c("PageTransitions").getNextURI(),B=t(A);if(n!==B)return;x()},x=function x(){n=null;l&&y.inform(h,l)},y=new(c("Arbiter"))(),z={getNextUnread:function A(){if(!l)return null;var B=c("NotificationStore").getNotification(l);if(!B||!s(B))return null;return B},getNextUnreadID:function A(){return l},getNextUnreadRowIndex:function A(){return m},subscribe:function A(B){return y.subscribe(h,B)},setMaxAge:function A(B){k=B},setTriggerAction:function A(B){o=B}};f.exports=z}),null);
__d("NotificationUpNextDialog.react",["cx","Arbiter","FunnelLogger","LayerFadeOnHide","LayerFadeOnShow","LayerHideOnTransition","Link.react","NotificationListConfig","NotificationListItemContents.react","NotificationListItemReadToggle.react","NotificationSeenState","NotificationTracking","NotificationUpNextStore","NotificationURI","NotificationUserActions","React","SubscriptionsHandler","URI","XUIContextualDialog.react","XUIContextualDialogBody.react","ifRequired","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g,h){"use strict";var i,j,k="notification_clicked",l=0,m="WWW_NOTIFS_UP_NEXT_FUNNEL",n=["hide","fail_max_impressions","fail_notif_validation"];function o(){c("FunnelLogger").startFunnel(m);c("FunnelLogger").addFunnelTag(m,l)}function p(r){c("FunnelLogger").appendAction(m,r);if(n.indexOf(r)!==-1)c("FunnelLogger").endFunnel(m)}i=babelHelpers.inherits(q,c("React").Component);j=i&&i.prototype;function q(){var r,s;for(var t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];return s=(r=j.constructor).call.apply(r,[this].concat(u)),this.$NotificationUpNextDialog3=true,this.$NotificationUpNextDialog4=new(c("SubscriptionsHandler"))(),this.state={isRead:false,rowIndex:null,shown:false,notification:null},this.$NotificationUpNextDialog11=function(){this.$NotificationUpNextDialog12()}.bind(this),this.$NotificationUpNextDialog13=function(){this.$NotificationUpNextDialog9()}.bind(this),this.$NotificationUpNextDialog7=function(){this.$NotificationUpNextDialog14()}.bind(this),this.$NotificationUpNextDialog18=function(){this.$NotificationUpNextDialog17();o();if(!this.$NotificationUpNextDialog20()){p("fail_max_impressions");return}var w=c("NotificationUpNextStore").getNextUnread();if(!w){p("fail_notif_validation");return}var x=c("NotificationUpNextStore").getNextUnreadRowIndex();p("show");this.setState({notification:w,rowIndex:x,isRead:c("NotificationSeenState").isRead(w.alert_id),shown:true});this.$NotificationUpNextDialog19()}.bind(this),this.$NotificationUpNextDialog9=function(){this.$NotificationUpNextDialog17();p("hide");this.setState({shown:false,notification:null})}.bind(this),this.$NotificationUpNextDialog21=function(){var w=this.state.notification;if(!w)return;p("click_notif");c("Arbiter").inform(k,{alertID:w.alert_id,endpointConfig:this.props.endpointConfig});this.$NotificationUpNextDialog9();c("NotificationUserActions").markNotificationsAsRead([w.alert_id],null)}.bind(this),this.$NotificationUpNextDialog11=function(){p("hover");this.$NotificationUpNextDialog12()}.bind(this),this.$NotificationUpNextDialog13=function(){this.$NotificationUpNextDialog19()}.bind(this),this.$NotificationUpNextDialog22=function(w){p("click_see_all");this.props.onFooterClick(w)}.bind(this),this.$NotificationUpNextDialog23=function(w){if(!w)this.$NotificationUpNextDialog9()}.bind(this),this.$NotificationUpNextDialog24=function(){p("toggle_read");var w=this.state,x=w.notification,y=w.isRead;if(!x)return;var z=x.alert_id;c("NotificationUserActions").setNextIsFromReadButton(true);if(!y)c("NotificationUserActions").markNotificationsAsRead([z],null);else if(c("NotificationListConfig").canMarkUnread)c("NotificationUserActions").markNotificationsAsUnread([z],null);this.setState({isRead:!y})}.bind(this),s}q.prototype.$NotificationUpNextDialog6=function(){this.$NotificationUpNextDialog5=c("NotificationUpNextStore").subscribe(this.$NotificationUpNextDialog7);this.$NotificationUpNextDialog4.addSubscriptions(this.$NotificationUpNextDialog5,c("Arbiter").subscribe("layer_shown",function(r,s){if(s&&s.type==="Jewel")if(this.$NotificationUpNextDialog8()){p("jewel_opened");this.$NotificationUpNextDialog9()}}.bind(this)));c("ifRequired")("ClientChromeStore",function(r){this.$NotificationUpNextDialog4.addSubscriptions({remove:r.subscribe(function(){var s=r.getState();if(s.bluebar.activeFlyout.type!=null)if(this.$NotificationUpNextDialog8()){p("jewel_opened");this.$NotificationUpNextDialog9()}}.bind(this))})}.bind(this))};q.prototype.$NotificationUpNextDialog10=function(){this.$NotificationUpNextDialog4&&this.$NotificationUpNextDialog4.release()};q.prototype.$NotificationUpNextDialog15=function(){var r=this.props.hideDelay;return r===-1?7500:r};q.prototype.$NotificationUpNextDialog16=function(){var r=this.props,s=r.hideDelay,t=r.hideOnBlur;return t?s!==-1:true};q.prototype.$NotificationUpNextDialog14=function(){this.$NotificationUpNextDialog17();var r=this.props.showDelay;this.$NotificationUpNextDialog1=c("setTimeoutAcrossTransitions")(this.$NotificationUpNextDialog18,r)};q.prototype.$NotificationUpNextDialog17=function(){if(this.$NotificationUpNextDialog1){clearTimeout(this.$NotificationUpNextDialog1);this.$NotificationUpNextDialog1=null}};q.prototype.$NotificationUpNextDialog19=function(){if(!this.$NotificationUpNextDialog16())return;this.$NotificationUpNextDialog12();this.$NotificationUpNextDialog2=c("setTimeoutAcrossTransitions")(this.$NotificationUpNextDialog9,this.$NotificationUpNextDialog15())};q.prototype.$NotificationUpNextDialog12=function(){if(this.$NotificationUpNextDialog2){clearTimeout(this.$NotificationUpNextDialog2);this.$NotificationUpNextDialog2=null}};q.prototype.$NotificationUpNextDialog20=function(){var r=this.props.maxImpressions;if(++l===r)this.$NotificationUpNextDialog5&&this.$NotificationUpNextDialog5.unsubscribe();return l<=r};q.prototype.$NotificationUpNextDialog8=function(){return this.state.shown};q.prototype.componentWillMount=function(){this.$NotificationUpNextDialog6()};q.prototype.componentWillUnmount=function(){this.$NotificationUpNextDialog10()};q.prototype.$NotificationUpNextDialog25=function(){var r=this.state,s=r.isRead,t=r.rowIndex,u=r.notification;if(!u)return;var v=c("NotificationURI").localize(new(c("URI"))(u.url)),w={ref:"notif_jewel",jewel:"notifications"},x=c("NotificationTracking").getTrackingString(u,t||0);return c("React").createElement("ul",{"data-gt":JSON.stringify(w)},c("React").createElement("li",{"data-gt":x,"data-alert-id":u.alert_id},c("React").createElement("div",{className:"_33c"+(!s?" _2qd6":"")},c("React").createElement("a",babelHelpers["extends"]({},u.primerAttributes,{href:v,role:"link",className:"_3fgk",onClick:this.$NotificationUpNextDialog21}),c("React").createElement(c("NotificationListItemContents.react"),{notification:u,noPhotoPreviews:true})),c("React").createElement("ul",{className:"_55mc"},c("React").createElement("li",{className:"_h_c"},this.$NotificationUpNextDialog26())))))};q.prototype.$NotificationUpNextDialog26=function(){var r=this.state.isRead;return c("React").createElement(c("NotificationListItemReadToggle.react"),{onToggleClick:this.$NotificationUpNextDialog24,isRead:r,canMarkUnread:c("NotificationListConfig").canMarkUnread})};q.prototype.render=function(){var r=this.state,s=r.notification,t=r.shown;if(!s)return null;var u=this.props,v=u.context,w=u.footer,x=u.hideOnBlur,y=u.title;return c("React").createElement(c("XUIContextualDialog.react"),{alignment:"right",autoFocus:false,behaviors:{LayerFadeOnShow:c("LayerFadeOnShow"),LayerFadeOnHide:c("LayerFadeOnHide"),LayerHideOnTransition:c("LayerHideOnTransition")},className:"_3fgl",context:v,dialogRole:"alert",hideOnBlur:x,focusContextOnHide:false,label:y,offsetY:-6,onToggle:this.$NotificationUpNextDialog23,position:"below",shown:t,width:250},c("React").createElement(c("XUIContextualDialogBody.react"),null,c("React").createElement("div",{onMouseEnter:this.$NotificationUpNextDialog11,onMouseLeave:this.$NotificationUpNextDialog13,onFocus:this.$NotificationUpNextDialog11,onBlur:this.$NotificationUpNextDialog13},c("React").createElement("h3",{className:"_3fgm"},y),c("React").createElement("div",{className:"_6296"},this.$NotificationUpNextDialog25()),c("React").createElement("div",{className:"_3fgo jewelFooter"},c("React").createElement(c("Link.react"),{role:"button",className:"seeMore",onClick:this.$NotificationUpNextDialog22},w)))))};f.exports=q}),null);